# Apache Airflow ‚Äî –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ –æ–±–ª–∞—á–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ

![Apache Airflow](https://img.shields.io/badge/Apache%20Airflow-2.11.0-blue)
![Docker](https://img.shields.io/badge/Docker-Compose-green)
![PostgreSQL](https://img.shields.io/badge/PostgreSQL-13-blue)
![License](https://img.shields.io/badge/License-Apache%202.0-orange)

Production-–≥–æ—Ç–æ–≤—ã–π Apache Airflow 2.11.0 —Å CeleryExecutor, PostgreSQL, Redis, NGINX –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º Prometheus.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
- [–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è](#-–ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è)
- [–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞](#-—É—Å—Ç–∞–Ω–æ–≤–∫–∞-–∏-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞)
  - [1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞](#1-–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞-—Å–µ—Ä–≤–µ—Ä–∞)
  - [2. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è](#2-–∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è)
  - [3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è](#3-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-–ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö-–æ–∫—Ä—É–∂–µ–Ω–∏—è)
  - [4. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–µ–∫—Ä–µ—Ç–Ω—ã—Ö –∫–ª—é—á–µ–π](#4-–≥–µ–Ω–µ—Ä–∞—Ü–∏—è-—Å–µ–∫—Ä–µ—Ç–Ω—ã—Ö-–∫–ª—é—á–µ–π)
  - [5. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSL](#5-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-ssl)
  - [6. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏](#6-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏)
  - [7. –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã](#7-–∑–∞–ø—É—Å–∫-—Å–∏—Å—Ç–µ–º—ã)
- [–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –ø–æ—Ä—Ç—ã](#-–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ-–ø–æ—Ä—Ç—ã)
- [–î–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–∏—Å–∞–º](#-–¥–æ—Å—Ç—É–ø-–∫-—Å–µ—Ä–≤–∏—Å–∞–º)
- [–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å](#-–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
- [–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ](#-—Ä–µ–∑–µ—Ä–≤–Ω–æ–µ-–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ)
- [–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥](#-–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥)
- [–û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ](#-–æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ)
- [–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫](#-—É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ-–Ω–µ–ø–æ–ª–∞–¥–æ–∫)
- [–ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã](#-—á–∞—Å—Ç–æ-–∑–∞–¥–∞–≤–∞–µ–º—ã–µ-–≤–æ–ø—Ä–æ—Å—ã)
- [–õ–∏—Ü–µ–Ω–∑–∏—è](#-–ª–∏—Ü–µ–Ω–∑–∏—è)

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```mermaid
graph TB
    User[–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å] --> NGINX[NGINX Reverse Proxy]
    NGINX -->|HTTPS| AirflowWS[Airflow Webserver]
    NGINX -->|HTTPS| Flower[Flower Monitor]
    Prometheus[Prometheus] -->|–ú–µ—Ç—Ä–∏–∫–∏| AirflowWS
    Prometheus -->|–ú–µ—Ç—Ä–∏–∫–∏| PostgresDB[(PostgreSQL)]
    
    AirflowWS -->|–ó–∞–¥–∞—á–∏| AirflowScheduler[Airflow Scheduler]
    AirflowScheduler -->|–û—á–µ—Ä–µ–¥—å| Redis[Redis Broker]
    Redis -->|–ó–∞–¥–∞—á–∏| AirflowWorker[Airflow Worker]
    AirflowWorker --> PostgresDB
    
    AirflowScheduler --> PostgresDB
    AirflowWS --> PostgresDB
    
    subgraph "–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å–µ—Ç—å Docker"
        AirflowWS
        AirflowScheduler
        AirflowWorker
        Redis
        PostgresDB
    end
```
## ‚öôÔ∏è –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –ê–ø–ø–∞—Ä–∞—Ç–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- **–ú–∏–Ω–∏–º—É–º:** 4 –ì–ë RAM, 2 CPU, 20 –ì–ë –¥–∏—Å–∫–∞
- **–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:** 8 –ì–ë RAM, 4 CPU, 50 –ì–ë –¥–∏—Å–∫–∞

### –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ
- **–û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞:** Ubuntu 20.04/22.04, Debian 10/11, CentOS 8
- **Docker:** –≤–µ—Ä—Å–∏—è 20.10+
- **Docker Compose:** –≤–µ—Ä—Å–∏—è 2.0+
- **Git:** –¥–ª—è –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

### –°–µ—Ç–µ–≤—ã–µ –ø–æ—Ä—Ç—ã
- **80/tcp** ‚Äî HTTP (—Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ HTTPS)
- **443/tcp** ‚Äî HTTPS (–æ—Å–Ω–æ–≤–Ω–æ–π –¥–æ—Å—Ç—É–ø)
- **9090/tcp** ‚Äî Prometheus (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- **5555/tcp** ‚Äî Flower (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

```bash
# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
sudo apt update && sudo apt upgrade -y

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker Compose
sudo apt install docker-compose-plugin -y

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –≥—Ä—É–ø–ø—É docker
sudo usermod -aG docker $USER
newgrp docker  # –∏–ª–∏ –ø–µ—Ä–µ–∑–∞–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É
```

### 2. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
git clone https://github.com/Alina-Bagaeva/Apache-Airflow.git
cd Apache-Airflow

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ñ–∞–π–ª–æ–≤
ls -la
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
cp .env.example .env

# –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
nano .env  # –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–∞—à –ª—é–±–∏–º—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä
```

**–í–∞–∂–Ω–æ:** –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –í–°–ï –ø–æ–ª—è –≤ —Ñ–∞–π–ª–µ `.env`:

```bash
# === –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ù–´–ï –ö–õ–Æ–ß–ò ===
FERNET_KEY=–≤–∞—à_—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π_fernet_–∫–ª—é—á
AIRFLOW_SECRET_KEY=–≤–∞—à_—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π_—Å–µ–∫—Ä–µ—Ç–Ω—ã–π_–∫–ª—é—á

# === –ë–ê–ó–´ –î–ê–ù–ù–´–• ===
POSTGRES_PASSWORD=–Ω–∞–¥–µ–∂–Ω—ã–π_–ø–∞—Ä–æ–ª—å_postgres
REDIS_PASSWORD=–Ω–∞–¥–µ–∂–Ω—ã–π_–ø–∞—Ä–æ–ª—å_redis

# === –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨ AIRFLOW ===
_AIRFLOW_WWW_USER_USERNAME=admin
_AIRFLOW_WWW_USER_PASSWORD=–Ω–∞–¥–µ–∂–Ω—ã–π_–ø–∞—Ä–æ–ª—å_–∞–¥–º–∏–Ω–∞

# === –°–ï–†–í–ï–†–ù–ê–Ø –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ===
# –£–∫–∞–∂–∏—Ç–µ IP –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ –∏–ª–∏ –¥–æ–º–µ–Ω–Ω–æ–µ –∏–º—è
DOMAIN_NAME=–í–ê–® IP –∏–ª–∏ –¥–æ–º–µ–Ω–Ω–æ–µ –∏–º—è
```

### 4. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–µ–∫—Ä–µ—Ç–Ω—ã—Ö –∫–ª—é—á–µ–π

```bash
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Fernet –∫–ª—é—á–∞ (–¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –ø–∞—Ä–æ–ª–µ–π –≤ –ë–î)
python3 -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
# –ü—Ä–∏–º–µ—Ä: sWxLUzD7NZmUukwLk2Gyu_zN5N-JlaeFl2XubO8cHZU=

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Secret –∫–ª—é—á–∞ (–¥–ª—è –ø–æ–¥–ø–∏—Å–∏ —Å–µ—Å—Å–∏–π)
python3 -c "import secrets; print(secrets.token_hex(32))"
# –ü—Ä–∏–º–µ—Ä: 90abaa83ed1a71c951b06d91c4aaef2f234fa41d54a289c0cde0c031003266b6

# –í—Å—Ç–∞–≤—å—Ç–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–ª—é—á–∏ –≤ —Ñ–∞–π–ª .env
```

### 5. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSL

#### –í–∞—Ä–∏–∞–Ω—Ç A: Self-signed —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è SSL
mkdir -p nginx/ssl

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è self-signed —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
  -keyout nginx/ssl/key.pem \
  -out nginx/ssl/cert.pem \
  -subj "/C=RU/ST=Moscow/L=Moscow/O=Company/CN=${DOMAIN_NAME}"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
openssl x509 -in nginx/ssl/cert.pem -text -noout
```

#### –í–∞—Ä–∏–∞–Ω—Ç B: Let's Encrypt (–¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Certbot
sudo apt install certbot python3-certbot-nginx -y

# –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
sudo certbot certonly --standalone -d ${DOMAIN_NAME} --email your-email@example.com

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
sudo cp /etc/letsencrypt/live/${DOMAIN_NAME}/fullchain.pem nginx/ssl/cert.pem
sudo cp /etc/letsencrypt/live/${DOMAIN_NAME}/privkey.pem nginx/ssl/key.pem
sudo chown $USER:$USER nginx/ssl/*.pem
```

### 6. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —É—Ç–∏–ª–∏—Ç—ã htpasswd
sudo apt install apache2-utils -y

# –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ —Å –ø–∞—Ä–æ–ª—è–º–∏
htpasswd -c nginx/.htpasswd admin
# –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è admin

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
htpasswd nginx/.htpasswd user2
```

### 7. –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã

```bash
# –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker compose up -d --build

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
docker compose ps

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker compose logs -f
```

## üîÑ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –ø–æ—Ä—Ç—ã

–ï—Å–ª–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø–æ—Ä—Ç—ã (80, 443, 9090, 5555) –∑–∞–Ω—è—Ç—ã –¥—Ä—É–≥–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏, –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –ø–æ—Ä—Ç—ã.

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤–æ–±–æ–¥–Ω—ã—Ö –ø–æ—Ä—Ç–æ–≤

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–Ω—è—Ç—ã–µ –ø–æ—Ä—Ç—ã
sudo netstat -tulpn | grep LISTEN
# –ò–ª–∏
sudo ss -tulpn

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø–æ—Ä—Ç
sudo lsof -i :8081
```

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –ø–æ—Ä—Ç–æ–≤

| –°–µ—Ä–≤–∏—Å | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–æ—Ä—Ç | –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ 1 | –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ 2 | –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ 3 |
|--------|------------------|----------------|----------------|----------------|
| **NGINX HTTP** | 80 | 8080 | 8081 | 8888 |
| **NGINX HTTPS** | 443 | 8443 | 9443 | 10443 |
| **Flower** | 5555 | 5556 | 5566 | 5656 |
| **Prometheus** | 9090 | 9091 | 9191 | 9292 |

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã—Ö –ø–æ—Ä—Ç–æ–≤

#### –°–ø–æ—Å–æ–± 1: –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤ docker-compose.yaml

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª `docker-compose.yaml`:

```yaml
services:
  nginx:
    ports:
      - "8081:80"      # –í–º–µ—Å—Ç–æ "80:80"
      - "8443:443"     # –í–º–µ—Å—Ç–æ "443:443"
  
  flower:
    ports:
      - "5556:5555"    # –í–º–µ—Å—Ç–æ "5555:5555"
  
  prometheus:
    ports:
      - "9091:9090"    # –í–º–µ—Å—Ç–æ "9090:9090"
```

#### –°–ø–æ—Å–æ–± 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `ports-override.yaml`:

```yaml
# ports-override.yaml
services:
  nginx:
    ports:
      - "8081:80"
      - "8443:443"
  
  flower:
    ports:
      - "5556:5555"
  
  prometheus:
    ports:
      - "9091:9090"
```

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º:
```bash
docker compose -f docker-compose.yaml -f ports-override.yaml up -d
```

#### –°–ø–æ—Å–æ–± 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —á–µ—Ä–µ–∑ .env —Ñ–∞–π–ª

–î–æ–±–∞–≤—å—Ç–µ –≤ `.env`:
```bash
# –£–∫–∞–∂–∏—Ç–µ –ø–æ—Ä—Ç –≤ –¥–æ–º–µ–Ω–Ω–æ–º –∏–º–µ–Ω–∏
DOMAIN_NAME=–í–ê–® IP:8443

# –ò–ª–∏ –æ—Ç–¥–µ–ª—å–Ω–æ
NGINX_HTTP_PORT=8081
NGINX_HTTPS_PORT=8443
FLOWER_PORT=5556
PROMETHEUS_PORT=9091
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ NGINX

–ï—Å–ª–∏ –º–µ–Ω—è–µ—Ç–µ –ø–æ—Ä—Ç—ã NGINX, –æ–±–Ω–æ–≤–∏—Ç–µ `nginx/conf.d/airflow.conf`:

```nginx
server {
    listen 8081;        # –í–º–µ—Å—Ç–æ 80
    server_name ${DOMAIN_NAME};
    return 301 https://$server_name:8443$request_uri;
}

server {
    listen 8443 ssl http2;  # –í–º–µ—Å—Ç–æ 443
    server_name ${DOMAIN_NAME};
    
    # –û–±–Ω–æ–≤–∏—Ç–µ proxy –∑–∞–≥–æ–ª–æ–≤–∫–∏
    location / {
        proxy_pass http://airflow_backend;
        proxy_set_header Host $host:8443;
        proxy_set_header X-Forwarded-Port 8443;
        # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏
    }
}
```

### –û—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ—Ä—Ç–æ–≤ –≤ —Ñ–∞–µ—Ä–≤–æ–ª–µ

–ù–µ –∑–∞–±—É–¥—å—Ç–µ –æ—Ç–∫—Ä—ã—Ç—å –Ω–æ–≤—ã–µ –ø–æ—Ä—Ç—ã:
```bash
sudo ufw allow 8443/tcp
sudo ufw allow 8081/tcp
sudo ufw allow 5556/tcp
sudo ufw allow 9091/tcp
```

### –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –ø–æ—Ä—Ç–æ–≤

**–î–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
- Airflow UI: `https://—Å–µ—Ä–≤–µ—Ä:8443`
- Flower: `https://—Å–µ—Ä–≤–µ—Ä:5556`
- Prometheus: `http://—Å–µ—Ä–≤–µ—Ä:9091`

**–î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ —Å –¥–æ–º–µ–Ω–æ–º:**
- Airflow UI: `https://airflow.–≤–∞—à-–¥–æ–º–µ–Ω.com` (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ 443)
- Flower: `https://flower.–≤–∞—à-–¥–æ–º–µ–Ω.com` (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ 443 —á–µ—Ä–µ–∑ –ø–æ–¥–¥–æ–º–µ–Ω)
- Prometheus: `https://metrics.–≤–∞—à-–¥–æ–º–µ–Ω.com` (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ 443 —á–µ—Ä–µ–∑ –ø–æ–¥–¥–æ–º–µ–Ω)

## üåê –î–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–∏—Å–∞–º

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å—ã –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ —Å–ª–µ–¥—É—é—â–∏–º –∞–¥—Ä–µ—Å–∞–º:

### –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø–æ—Ä—Ç—ã:
| –°–µ—Ä–≤–∏—Å | URL | –ü–æ—Ä—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|-----|------|----------|
| **Airflow UI** | `https://–≤–∞—à-—Å–µ—Ä–≤–µ—Ä-ip` | 443 | –û—Å–Ω–æ–≤–Ω–æ–π –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Airflow |
| **Flower** | `https://–≤–∞—à-—Å–µ—Ä–≤–µ—Ä-ip:5555` | 5555 | –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Celery workers |
| **Prometheus** | `http://–≤–∞—à-—Å–µ—Ä–≤–µ—Ä-ip:9090` | 9090 | –ú–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ |
| **Airflow API** | `https://–≤–∞—à-—Å–µ—Ä–≤–µ—Ä-ip/api/v1/` | 443 | REST API Airflow |
| **Health Check** | `https://–≤–∞—à-—Å–µ—Ä–≤–µ—Ä-ip/health` | 443 | –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–∏—Å—Ç–µ–º—ã |

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –ø–æ—Ä—Ç—ã (–µ—Å–ª–∏ –∑–∞–Ω—è—Ç—ã —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ):
| –°–µ—Ä–≤–∏—Å | URL | –ü–æ—Ä—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|-----|------|----------|
| **Airflow UI** | `https://–≤–∞—à-—Å–µ—Ä–≤–µ—Ä-ip:8443` | 8443 | –û—Å–Ω–æ–≤–Ω–æ–π –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Airflow |
| **Flower** | `https://–≤–∞—à-—Å–µ—Ä–≤–µ—Ä-ip:5556` | 5556 | –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Celery workers |
| **Prometheus** | `http://–≤–∞—à-—Å–µ—Ä–≤–µ—Ä-ip:9091` | 9091 | –ú–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ |

### –ü–µ—Ä–≤—ã–π –≤—Ö–æ–¥ –≤ Airflow

1. –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä: `https://–≤–∞—à-—Å–µ—Ä–≤–µ—Ä-ip` (–∏–ª–∏ `https://–≤–∞—à-—Å–µ—Ä–≤–µ—Ä-ip:8443` –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –ø–æ—Ä—Ç—ã)
2. –í–≤–µ–¥–∏—Ç–µ –±–∞–∑–æ–≤—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é:
   - –õ–æ–≥–∏–Ω: `admin` (–∏–∑ `.htpasswd`)
   - –ü–∞—Ä–æ–ª—å: —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ `.htpasswd`
3. –í–æ–π–¥–∏—Ç–µ –≤ Airflow:
   - –õ–æ–≥–∏–Ω: `admin` (–∏–∑ `_AIRFLOW_WWW_USER_USERNAME`)
   - –ü–∞—Ä–æ–ª—å: —É–∫–∞–∑–∞–Ω–Ω—ã–π –≤ `_AIRFLOW_WWW_USER_PASSWORD`

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

- [ ] **–°–º–µ–Ω–∏—Ç–µ –≤—Å–µ –ø–∞—Ä–æ–ª–∏** –≤ `.env` —Ñ–∞–π–ª–µ
- [ ] **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã** –æ—Ç Let's Encrypt
- [ ] **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ñ–∞–π—Ä–≤–æ–ª**:
  ```bash
  # –†–∞–∑—Ä–µ—à–∏—Ç—å —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ—Ä—Ç—ã
  sudo ufw allow 22/tcp      # SSH
  sudo ufw allow 80/tcp      # HTTP (–∏–ª–∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ—Ä—Ç)
  sudo ufw allow 443/tcp     # HTTPS (–∏–ª–∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ—Ä—Ç)
  sudo ufw --force enable
  ```

- [ ] **–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –ø–æ IP** –≤ `nginx/conf.d/airflow.conf`:
  ```nginx
  location ~ ^/(api/v1/|flower|variables|connections) {
    allow 192.168.1.0/24;    # –í–∞—à–∞ –ª–æ–∫–∞–ª—å–Ω–∞—è —Å–µ—Ç—å
    allow 10.0.0.0/8;        # –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å–µ—Ç—å
    deny all;
  }
  ```

- [ ] **–†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ** –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:
  ```bash
  docker compose pull
  docker compose up -d
  ```

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

1. **–î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
   ```bash
   # –í .env –¥–æ–±–∞–≤—å—Ç–µ:
   AIRFLOW__WEBSERVER__AUTHENTICATE=true
   AIRFLOW__API__AUTH_BACKENDS=airflow.api.auth.backend.session
   ```

2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤**:
   ```bash
   # –î–æ–±–∞–≤—å—Ç–µ –≤ crontab
   0 3 * * * certbot renew --quiet && docker compose restart nginx
   ```

## üíæ –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –°–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º
chmod +x backup.sh

# –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –±—ç–∫–∞–ø–∞
./backup.sh
# –ë—ç–∫–∞–ø —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ –ø–∞–ø–∫–µ ./backups/

# –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ cron
crontab -e
# –î–æ–±–∞–≤—å—Ç–µ —Å—Ç—Ä–æ–∫—É:
0 2 * * * /–ø—É—Ç—å/–∫/Apache-Airflow/backup.sh
```

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Airflow
docker compose stop airflow-webserver airflow-scheduler

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
docker compose exec -T postgres psql -U airflow -d airflow < backups/–≤–∞—à_–±—ç–∫–∞–ø.sql

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ Airflow
docker compose start airflow-webserver airflow-scheduler
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Prometheus –º–µ—Ç—Ä–∏–∫–∏

Prometheus —Å–æ–±–∏—Ä–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏:
- **Airflow Webserver**: `https://–≤–∞—à-—Å–µ—Ä–≤–µ—Ä-ip/metrics`
- **PostgreSQL**: –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –º–µ—Ç—Ä–∏–∫–∏ –ë–î

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–ª–µ—Ä—Ç–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `prometheus/alerts.yml`:

```yaml
groups:
  - name: airflow_alerts
    rules:
      - alert: AirflowSchedulerDown
        expr: up{job="airflow-scheduler"} == 0
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "Airflow Scheduler is down"
          
      - alert: HighDAGFailureRate
        expr: rate(airflow_dagrun_failed[10m]) > 0.1
        for: 5m
        labels:
          severity: warning
```

## üõ†Ô∏è –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ

### –ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
docker compose ps
docker compose logs --tail=50

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤
docker compose restart airflow-scheduler
docker compose restart nginx

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker compose pull
docker compose up -d

# –û—á–∏—Å—Ç–∫–∞ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö
docker system prune -a --volumes
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ DAGs

```bash
# –ü–∞—É–∑–∞/—Ä–∞—Å–ø–∞—É–∑–∞ DAG
docker compose exec airflow-webserver airflow dags pause dag_id
docker compose exec airflow-webserver airflow dags unpause dag_id

# –ó–∞–ø—É—Å–∫ DAG –≤—Ä—É—á–Ω—É—é
docker compose exec airflow-webserver airflow dags trigger dag_id

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ DAG
docker compose exec airflow-webserver airflow tasks list dag_id
```

### –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ—Ä–∫–µ—Ä–æ–≤

```bash
# –ò–∑–º–µ–Ω–∏—Ç–µ –≤ .env:
WORKER_MEMORY_LIMIT=8G
WORKER_CPUS=4

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –≤–æ—Ä–∫–µ—Ä
docker compose up -d --force-recreate airflow-worker
```

## üêõ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –û–±—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

#### 1. **–û—à–∏–±–∫–∞ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞**
```
–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
```
**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
openssl x509 -in nginx/ssl/cert.pem -text -noout

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ NGINX
docker compose restart nginx
```

#### 2. **Airflow –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è**
```
airflow.db.migrations.exceptions.DatabaseNotReady: Database not ready
```
**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ PostgreSQL
docker compose logs postgres

# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞
docker compose down -v
docker compose up -d
```

#### 3. **–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö**
```
psycopg2.OperationalError: could not connect to server
```
**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞—Ä–æ–ª—å –≤ .env
echo $POSTGRES_PASSWORD

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä PostgreSQL
docker compose exec postgres pg_isready -U airflow
```

#### 4. **–ü–æ—Ä—Ç —É–∂–µ –∑–∞–Ω—è—Ç**
```
Bind for 0.0.0.0:80 failed: port is already allocated
```
**–†–µ—à–µ–Ω–∏–µ:**
1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ [–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –ø–æ—Ä—Ç—ã](#-–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ-–ø–æ—Ä—Ç—ã)
2. –û—Å–≤–æ–±–æ–¥–∏—Ç–µ –ø–æ—Ä—Ç:
   ```bash
   # –ù–∞–π—Ç–∏ –ø—Ä–æ—Ü–µ—Å—Å, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π –ø–æ—Ä—Ç
   sudo lsof -i :80
   sudo lsof -i :443
   
   # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å (–µ—Å–ª–∏ —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ)
   sudo systemctl stop nginx  # –µ—Å–ª–∏ —ç—Ç–æ —Å–∏—Å—Ç–µ–º–Ω—ã–π nginx
   ```

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker compose ps --services | xargs -I {} sh -c 'echo "=== {} ===" && docker compose exec {} curl -s http://localhost:8080/health 2>/dev/null || echo "Health check not available"'

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞
df -h
docker system df

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
docker network inspect airflow-airflow-network

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
docker compose logs -f --tail=100

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–Ω—è—Ç—ã—Ö –ø–æ—Ä—Ç–æ–≤
sudo netstat -tulpn | grep LISTEN
```

## ‚ùì –ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã

### Q: –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π DAG?
**A:** –ï—Å—Ç—å –¥–≤–∞ —Å–ø–æ—Å–æ–±–∞ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π DAG:

#### –°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Airflow Code Editor (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
1. –í–æ–π–¥–∏—Ç–µ –≤ Airflow UI (`https://–≤–∞—à-—Å–µ—Ä–≤–µ—Ä`)
2. –í –≤–µ—Ä—Ö–Ω–µ–º –º–µ–Ω—é –≤—ã–±–µ—Ä–∏—Ç–µ **Admin ‚Üí Airflow Code Editor**
3. –í –ª–µ–≤–æ–π –ø–∞–Ω–µ–ª–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –ø–∞–ø–∫—É `/opt/airflow/dags/`
4. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É **"New File"** –∏–ª–∏ **"New Folder"**
5. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π Python —Ñ–∞–π–ª (–Ω–∞–ø—Ä–∏–º–µ—Ä: `my_new_dag.py`)
6. –ù–∞–ø–∏—à–∏—Ç–µ –∫–æ–¥ DAG –∏ –Ω–∞–∂–º–∏—Ç–µ **"Save"**
7. DAG –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—è–≤–∏—Ç—Å—è –≤ —Å–ø–∏—Å–∫–µ —á–µ—Ä–µ–∑ 30-60 —Å–µ–∫—É–Ω–¥

#### –°–ø–æ—Å–æ–± 2: –ß–µ—Ä–µ–∑ —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É
1. –î–æ–±–∞–≤—å—Ç–µ Python —Ñ–∞–π–ª –≤ –ª–æ–∫–∞–ª—å–Ω—É—é –ø–∞–ø–∫—É `./dags/`
2. –ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:
```bash
Apache-Airflow/
‚îî‚îÄ‚îÄ dags/
    ‚îú‚îÄ‚îÄ dag_with_clickhouse.py  # —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π DAG
    ‚îî‚îÄ‚îÄ my_new_dag.py          # –Ω–æ–≤—ã–π DAG

Airflow –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–∞—Ä—É–∂–∏—Ç –µ–≥–æ —á–µ—Ä–µ–∑ 30-60 —Å–µ–∫—É–Ω–¥.

### Q: –ö–∞–∫ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞?
**A:**
```bash
# 1. –ò–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª—å –≤ .env (–ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è _AIRFLOW_WWW_USER_PASSWORD)
# 2. –ü–µ—Ä–µ—Å–æ–∑–¥–∞–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
docker compose exec airflow-webserver airflow users create \
  --username admin \
  --firstname Admin \
  --lastname User \
  --role Admin \
  --email admin@example.com \
  --password –Ω–æ–≤—ã–π_–ø–∞—Ä–æ–ª—å
```

### Q: –ß—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ –ø–æ—Ä—Ç—ã 80 –∏ 443 –∑–∞–Ω—è—Ç—ã?
**A:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –ø–æ—Ä—Ç—ã –∫–∞–∫ –æ–ø–∏—Å–∞–Ω–æ –≤ —Ä–∞–∑–¥–µ–ª–µ [–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –ø–æ—Ä—Ç—ã](#-–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ-–ø–æ—Ä—Ç—ã). –ù–∞–ø—Ä–∏–º–µ—Ä:
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ 8081 –¥–ª—è HTTP –∏ 8443 –¥–ª—è HTTPS
- –û–±–Ω–æ–≤–∏—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é NGINX –∏ docker-compose.yaml
- –û—Ç–∫—Ä–æ–π—Ç–µ –Ω–æ–≤—ã–µ –ø–æ—Ä—Ç—ã –≤ —Ñ–∞–µ—Ä–≤–æ–ª–µ

### Q: –ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π?
**A:** –î–æ–±–∞–≤—å—Ç–µ –≤ `.env`:
```bash
AIRFLOW__SMTP__SMTP_HOST=smtp.gmail.com
AIRFLOW__SMTP__SMTP_USER=–≤–∞—à_email@gmail.com
AIRFLOW__SMTP__SMTP_PASSWORD=–≤–∞—à_–ø–∞—Ä–æ–ª—å
AIRFLOW__SMTP__SMTP_PORT=587
AIRFLOW__SMTP__SMTP_MAIL_FROM=–≤–∞—à_email@gmail.com
```

### Q: –ö–∞–∫ —É–≤–µ–ª–∏—á–∏—Ç—å –æ–±—ä–µ–º –ø–∞–º—è—Ç–∏ –¥–ª—è –≤–æ—Ä–∫–µ—Ä–æ–≤?
**A:** –ò–∑–º–µ–Ω–∏—Ç–µ –≤ `.env`:
```bash
WORKER_MEMORY_LIMIT=8G
WORKER_MEMORY_RESERVATION=4G
```
–ó–∞—Ç–µ–º –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ: `docker compose up -d airflow-worker`

### Q: –ö–∞–∫ –æ–±–Ω–æ–≤–∏—Ç—å –≤–µ—Ä—Å–∏—é Airflow?
**A:**
```bash
# 1. –û–±–Ω–æ–≤–∏—Ç–µ –≤–µ—Ä—Å–∏—é –≤ requirements.txt
# 2. –û–±–Ω–æ–≤–∏—Ç–µ –≤–µ—Ä—Å–∏—é –≤ Dockerfile
# 3. –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –æ–±—Ä–∞–∑—ã
docker compose down
docker compose build --no-cache
docker compose up -d
```

### Q: –ú–æ–∂–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–æ–º–µ–Ω–Ω–æ–µ –∏–º—è –≤–º–µ—Å—Ç–æ IP?
**A:** –î–∞, —É–∫–∞–∂–∏—Ç–µ –¥–æ–º–µ–Ω–Ω–æ–µ –∏–º—è –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `DOMAIN_NAME` –≤ —Ñ–∞–π–ª–µ `.env`:
```bash
DOMAIN_NAME=airflow.–≤–∞—à-–¥–æ–º–µ–Ω.com
```
–ù–µ –∑–∞–±—É–¥—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å DNS –∑–∞–ø–∏—Å–∏ –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–µ–Ω–∞.

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Apache License 2.0. –°–º. —Ñ–∞–π–ª [LICENSE](LICENSE) –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π.

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ —É –≤–∞—Å –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:** `docker compose logs`
2. **–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –ø–æ—Ä—Ç—ã –æ—Ç–∫—Ä—ã—Ç—ã:** `sudo ufw status`
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã:** `openssl s_client -connect –≤–∞—à-—Å–µ—Ä–≤–µ—Ä:443`
4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–Ω—è—Ç—ã–µ –ø–æ—Ä—Ç—ã:** `sudo netstat -tulpn`
5. **–°–æ–∑–¥–∞–π—Ç–µ issue** –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ GitHub

---

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –≠—Ç–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è. –í—Å–µ–≥–¥–∞ —Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ staging-–æ–∫—Ä—É–∂–µ–Ω–∏–∏ –ø–µ—Ä–µ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ.

**–ê–≤—Ç–æ—Ä:** Alina Bagaeva  
**–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:** https://github.com/Alina-Bagaeva/Apache-Airflow  
**–í–µ—Ä—Å–∏—è:** 1.0.0  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** –Ø–Ω–≤–∞—Ä—å 2026
